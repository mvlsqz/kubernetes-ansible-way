#- name: install cfssl and cfssljson
#  get_url:
#    url: "{{ item.source }}"
#    dest: "{{ item.destination }}"
#  loop:
#    - { source: 'https://storage.googleapis.com/kubernetes-the-hard-way/cfssl/darwin/cfssl', destination: '/usr/local/bin/cfssl' }
#    - { source: 'https://storage.googleapis.com/kubernetes-the-hard-way/cfssl/darwin/cfssljson', destination: '/usr/local/bin/cfssljson' }
#    - { source: 'https://storage.googleapis.com/kubernetes-release/release/v1.15.3/bin/linux/amd64/kubectl', destination: '/usr/local/bin/kubectl'}
#
#- name: Adding execution bit to tools
#  file:
#    path: "{{ item }}"
#    mode: '0777'
#  loop:
#    - /usr/local/bin/cfssl
#    - /usr/local/bin/cfssljson
#    - /usr/local/bin/kubectl

- name: Install iptables backends
  package:
    name: "{{ item }}"
    state: present
  loop:
    - iptables
    - arptables
    - ebtables

- name: adding kubernetes gpg key
  apt_key:
    url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
    state: present

- name: adding kubernetes community repository
  apt_repository:
    repo: 'deb https://apt.kubernetes.io/ kubernetes-xenial main'
    state: present

- name: Installing kubeadm, kubelet and kubectl
  package:
    name: "{{ item }}"
    state: present
  loop:
    - kubelet
    - kubeadm
    - kubectl

- name:
  service:
    name: kubelet
    state: started
    enabled: yes
